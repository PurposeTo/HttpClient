Что, если format() нужно выполнять каждый раз перед waitUntil?
И если перед вайт антил нужно будет сформатировать из строки в один объект, а после вайт антил из строки в совсем другой объект?
Возможно, понадобятся методы, как "if-then-else"

Тело ответа: может быть не только string